<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloodCast Model Validation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #3498db;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            font-weight: bold;
            background-color: #f1f8ff;
        }
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .error-card {
            background-color: #ffecec;
            border-left: 4px solid #e74c3c;
        }
        .chart-container {
            height: 300px;
        }
        .footer {
            margin-top: 20px;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        .good-metric {
            color: #27ae60;
        }
        .medium-metric {
            color: #f39c12;
        }
        .poor-metric {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Model Validation Metrics</h1>
            <p>These metrics help assess the accuracy and reliability of the flood prediction model. Last updated: <span id="lastUpdated">2025-08-29 14:48:12</span></p>
        </div>
        
        <div class="row">
            <!-- Water Level Prediction Metrics -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-graph-up" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0Zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07Z"/>
                        </svg>
                        Water Level Prediction Accuracy
                    </div>
                    <div class="card-body">
                        <p>These metrics evaluate how accurately the model predicts water levels</p>
                        <div class="row">
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Mean Absolute Error (MAE)</div>
                                <div class="metric-value good-metric" id="mae-value">0.38 cm</div>
                                <div class="small">Average prediction error</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Root Mean Square Error</div>
                                <div class="metric-value good-metric" id="rmse-value">0.51 cm</div>
                                <div class="small">Error magnitude</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">R² Score</div>
                                <div class="metric-value good-metric" id="r2-value">0.9997</div>
                                <div class="small">Accuracy score (0-1)</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Mean Absolute % Error</div>
                                <div class="metric-value good-metric" id="mape-value">0.46%</div>
                                <div class="small">Percentage error</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Flood Event Detection Metrics -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                        </svg>
                        Flood Event Detection Performance
                    </div>
                    <div class="card-body">
                        <p>How well the model detects and warns about flood events</p>
                        <div class="row">
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Detection Rate</div>
                                <div class="metric-value good-metric" id="detection-value">100.0%</div>
                                <div class="small">Floods correctly predicted</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">False Alarm Rate</div>
                                <div class="metric-value good-metric" id="false-alarm-value">0.0%</div>
                                <div class="small">Incorrect flood warnings</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Lead Time</div>
                                <div class="metric-value good-metric" id="lead-time-value">48.0 hours</div>
                                <div class="small">Warning time before flood</div>
                            </div>
                            <div class="col-md-6 text-center mb-4">
                                <div class="metric-label">Confidence Score</div>
                                <div class="metric-value good-metric" id="confidence-value">97.8%</div>
                                <div class="small">Prediction reliability</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Predictive Factors Section -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bar-chart" viewBox="0 0 16 16">
                            <path d="M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
                        </svg>
                        Top Predictive Factors
                    </div>
                    <div class="card-body">
                        <p>The most influential factors in determining flood risk</p>
                        <div class="chart-container">
                            <canvas id="factorsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Forecast Accuracy by Horizon -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
                            <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                        </svg>
                        Forecast Accuracy by Time Horizon
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <div class="metric-label">6-hour forecast</div>
                                <div class="metric-value good-metric">0.9999</div>
                                <div class="small">R² Score</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-label">12-hour forecast</div>
                                <div class="metric-value good-metric">0.9998</div>
                                <div class="small">R² Score</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-label">24-hour forecast</div>
                                <div class="metric-value good-metric">0.9993</div>
                                <div class="small">R² Score</div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="metric-label">48-hour forecast</div>
                                <div class="metric-value good-metric">0.9972</div>
                                <div class="small">R² Score</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>FloodCast Enhanced Model with Tidal Data Integration | ©2025 FloodCast Project</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load metrics via API call
            fetch('/api/model-verification')
                .then(response => response.json())
                .then(data => {
                    console.log("Metrics data loaded:", data);
                    
                    // Update water level prediction metrics
                    if (data.enhanced_model) {
                        document.getElementById('mae-value').textContent = data.enhanced_model.mae + " cm";
                        document.getElementById('rmse-value').textContent = data.enhanced_model.rmse + " cm";
                        document.getElementById('r2-value').textContent = data.enhanced_model.r2;
                        document.getElementById('mape-value').textContent = data.enhanced_model.mape + "%";
                    }
                    
                    // Update flood detection metrics
                    if (data.extreme_events) {
                        document.getElementById('detection-value').textContent = data.extreme_events.correct_predictions + "%";
                        document.getElementById('false-alarm-value').textContent = data.extreme_events.false_alarms + "%";
                        document.getElementById('lead-time-value').textContent = data.enhanced_model.lead_time_hours + " hours";
                        document.getElementById('confidence-value').textContent = data.extreme_events.lead_time_accuracy + "%";
                    }
                    
                    // Last updated timestamp
                    document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                    
                    // Create the feature importance chart
                    createFeatureChart();
                })
                .catch(error => {
                    console.error("Error loading metrics:", error);
                    document.querySelector('.container').insertAdjacentHTML('afterbegin', 
                        `<div class="alert alert-danger">
                            Error loading metrics data. Please try refreshing the page.
                        </div>`
                    );
                });
            
            // Create feature importance chart
            function createFeatureChart() {
                const ctx = document.getElementById('factorsChart').getContext('2d');
                
                const featureData = [
                    { feature: 'water_level_lag1', importance: 55.57 },
                    { feature: 'tide_level', importance: 4.76 },
                    { feature: 'tide_level_lag2', importance: 3.42 },
                    { feature: 'tide_level_lag1', importance: 3.13 },
                    { feature: 'water_level_lag3', importance: 2.61 },
                    { feature: 'water_level_velocity', importance: 2.36 },
                    { feature: 'water_level_lag6', importance: 2.11 },
                    { feature: 'tide_range_6h', importance: 1.58 }
                ];
                
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: featureData.map(item => item.feature.replace(/_/g, ' ')),
                        datasets: [{
                            label: 'Feature Importance (%)',
                            data: featureData.map(item => item.importance),
                            backgroundColor: [
                                '#3498db', '#2ecc71', '#9b59b6', '#e74c3c',
                                '#f39c12', '#16a085', '#2980b9', '#8e44ad'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        plugins: {
                            title: {
                                display: true,
                                text: 'Top Features by Importance (%)'
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Importance (%)'
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
